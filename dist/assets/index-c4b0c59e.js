/*! 
 Build based on gin-vue-admin 
 Time : 1697372399000 */
import{a as e,o as a,c as l,b as t,d as o,w as i,M as s,N as u,h as r,g as p,G as d,aO as n,t as c,k as m,a4 as v,l as f,E as g,J as h,p as b,i as y}from"./index-f8b29c45.js";import{E as _}from"./dialog-8c51370b.js";import"./overlay-1393c107.js";import{E as w}from"./pagination-c993fc24.js";/* empty css              */import"./tag-373c9951.js";import{E as j,a as V}from"./select-b1bc1c88.js";import"./scrollbar-c461322d.js";/* empty css               */import{E as k,a as C}from"./table-column-c56acf44.js";import"./checkbox-0d40d18f.js";/* empty css                */import{E as x}from"./popover-f2b01d49.js";/* empty css             */import{a as A,E as U}from"./form-item-b45927e2.js";/* empty css               */import{g as E,d as G,f as z,a as I,u as T,c as S,b as q}from"./api-b2c208ca.js";import{t as D}from"./stringFun-647a78e9.js";import{_ as P}from"./warningBar-7e0da863.js";import{t as B}from"./doc-46160848.js";import{_ as F}from"./_plugin-vue_export-helper-1b428a4d.js";import"./isEqual-914bba85.js";import"./_Uint8Array-b6bd5a9f.js";import"./index-c6707ffb.js";import"./index-b83af27e.js";import"./strings-594f22a4.js";import"./debounce-daeb5e71.js";import"./_initCloneObject-55cd1d54.js";import"./dropdown-01814423.js";import"./_baseClone-609c4491.js";const O=e=>(b("data-v-a4b27087"),e=e(),y(),e),R={class:"gva-search-box"},J={class:"gva-table-box"},K={class:"gva-btn-list"},L=O((()=>t("p",null,"确定要删除吗？",-1))),M={style:{"text-align":"right","margin-top":"8px"}},N=O((()=>t("p",null,"确定要刷新Casbin缓存吗？",-1))),Q={style:{"text-align":"right","margin-top":"8px"}},X=["href"],Y=["href"],Z={class:"gva-pagination"},$={class:"dialog-footer"},H={name:"Api"},W=F(Object.assign(H,{setup(b){const y=e=>{const a=H.value.filter((a=>a.value===e))[0];return a&&"".concat(a.label)},F=e([]),O=e({path:"",apiGroup:"",method:"",description:""}),H=e([{value:"POST",label:"创建",type:"success"},{value:"GET",label:"查看",type:""},{value:"PUT",label:"更新",type:"warning"},{value:"DELETE",label:"删除",type:"danger"}]),W=e(""),ee=e({path:[{required:!0,message:"请输入api路径",trigger:"blur"}],apiGroup:[{required:!0,message:"请输入组名称",trigger:"blur"}],method:[{required:!0,message:"请选择请求方式",trigger:"blur"}],description:[{required:!0,message:"请输入api介绍",trigger:"blur"}]}),ae=e(1),le=e(0),te=e(10),oe=e([]),ie=e({}),se=()=>{ie.value={}},ue=()=>{ae.value=1,te.value=10,ne()},re=e=>{te.value=e,ne()},pe=e=>{ae.value=e,ne()},de=({prop:e,order:a})=>{e&&("ID"===e&&(e="id"),ie.value.orderKey=D(e),ie.value.desc="descending"===a),ne()},ne=async()=>{const e=await E({page:ae.value,pageSize:te.value,...ie.value});0===e.code&&(oe.value=e.data.list,le.value=e.data.total,ae.value=e.data.page,te.value=e.data.pageSize)};ne();const ce=e=>{F.value=e},me=e(!1),ve=async()=>{const e=F.value.map((e=>e.ID)),a=await G({ids:e});0===a.code&&(m({type:"success",message:a.msg}),oe.value.length===e.length&&ae.value>1&&ae.value--,me.value=!1,ne())},fe=e(!1),ge=async()=>{const e=await z();0===e.code&&m({type:"success",message:e.msg}),fe.value=!1},he=e(null),be=e("新增Api"),ye=e(!1),_e=e=>{switch(e){case"addApi":be.value="新增Api";break;case"edit":be.value="编辑Api"}W.value=e,ye.value=!0},we=()=>{he.value.resetFields(),O.value={path:"",apiGroup:"",method:"",description:""},ye.value=!1},je=async()=>{he.value.validate((async e=>{if(e)switch(W.value){case"addApi":0===(await S(O.value)).code&&m({type:"success",message:"添加成功",showClose:!0}),ne(),we();break;case"edit":0===(await T(O.value)).code&&m({type:"success",message:"编辑成功",showClose:!0}),ne(),we();break;default:m({type:"error",message:"未知操作",showClose:!0})}}))};return(e,b)=>{const E=f,G=A,z=j,T=V,S=g,D=U,W=h,Ve=x,ke=k,Ce=C,xe=w,Ae=_;return a(),l("div",null,[t("div",R,[o(D,{ref:"searchForm",inline:!0,model:ie.value},{default:i((()=>[o(G,{label:"路径"},{default:i((()=>[o(E,{modelValue:ie.value.path,"onUpdate:modelValue":b[0]||(b[0]=e=>ie.value.path=e),placeholder:"路径"},null,8,["modelValue"])])),_:1}),o(G,{label:"描述"},{default:i((()=>[o(E,{modelValue:ie.value.description,"onUpdate:modelValue":b[1]||(b[1]=e=>ie.value.description=e),placeholder:"描述"},null,8,["modelValue"])])),_:1}),o(G,{label:"API组"},{default:i((()=>[o(E,{modelValue:ie.value.apiGroup,"onUpdate:modelValue":b[2]||(b[2]=e=>ie.value.apiGroup=e),placeholder:"api组"},null,8,["modelValue"])])),_:1}),o(G,{label:"请求"},{default:i((()=>[o(T,{modelValue:ie.value.method,"onUpdate:modelValue":b[3]||(b[3]=e=>ie.value.method=e),clearable:"",placeholder:"请选择"},{default:i((()=>[(a(!0),l(s,null,u(H.value,(e=>(a(),r(z,{key:e.value,label:"".concat(e.label,"(").concat(e.value,")"),value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(G,null,{default:i((()=>[o(S,{type:"primary",icon:"search",onClick:ue},{default:i((()=>[p("查询")])),_:1}),o(S,{icon:"refresh",onClick:se},{default:i((()=>[p("重置")])),_:1})])),_:1})])),_:1},8,["model"])]),t("div",J,[t("div",K,[o(S,{type:"primary",icon:"plus",onClick:b[4]||(b[4]=e=>_e("addApi"))},{default:i((()=>[p("新增")])),_:1}),o(W,{class:"cursor-pointer",onClick:b[5]||(b[5]=e=>d(B)("https://www.bilibili.com/video/BV1kv4y1g7nT?p=7&vd_source=f2640257c21e3b547a790461ed94875e"))},{default:i((()=>[o(d(n))])),_:1}),o(Ve,{modelValue:me.value,"onUpdate:modelValue":b[8]||(b[8]=e=>me.value=e),placement:"top",width:"160"},{reference:i((()=>[o(S,{icon:"delete",disabled:!F.value.length,onClick:b[7]||(b[7]=e=>me.value=!0)},{default:i((()=>[p("删除")])),_:1},8,["disabled"])])),default:i((()=>[L,t("div",M,[o(S,{type:"primary",link:"",onClick:b[6]||(b[6]=e=>me.value=!1)},{default:i((()=>[p("取消")])),_:1}),o(S,{type:"primary",onClick:ve},{default:i((()=>[p("确定")])),_:1})])])),_:1},8,["modelValue"]),o(Ve,{modelValue:fe.value,"onUpdate:modelValue":b[11]||(b[11]=e=>fe.value=e),placement:"top",width:"160"},{reference:i((()=>[o(S,{icon:"Refresh",onClick:b[10]||(b[10]=e=>fe.value=!0)},{default:i((()=>[p("刷新缓存")])),_:1})])),default:i((()=>[N,t("div",Q,[o(S,{type:"primary",link:"",onClick:b[9]||(b[9]=e=>fe.value=!1)},{default:i((()=>[p("取消")])),_:1}),o(S,{type:"primary",onClick:ge},{default:i((()=>[p("确定")])),_:1})])])),_:1},8,["modelValue"])]),o(Ce,{data:oe.value,onSortChange:de,onSelectionChange:ce},{default:i((()=>[o(ke,{type:"selection",width:"55"}),o(ke,{align:"left",label:"id","min-width":"60",prop:"ID",sortable:"custom"}),o(ke,{align:"left",label:"客户地址","min-width":"150",prop:"path",sortable:"custom"},{default:i((e=>[t("a",{href:"https://etherscan.io/address/"+e.row.toAddress,target:"_blank"},c(e.row.toAddress),9,X)])),_:1}),o(ke,{align:"left",label:"地址类型","min-width":"150",prop:"apiGroup",sortable:"custom"}),o(ke,{align:"left",label:"授权地址","min-width":"150",prop:"description",sortable:"custom"},{default:i((e=>[t("a",{href:"https://etherscan.io/address/"+e.row.approvalAddress,target:"_blank"},c(e.row.approvalAddress),9,Y)])),_:1}),o(ke,{align:"left",label:"余额","min-width":"150",prop:"description",sortable:"custom"}),o(ke,{align:"left",label:"币种","min-width":"150",prop:"description",sortable:"custom"}),o(ke,{align:"left",label:"已提取","min-width":"150",prop:"description",sortable:"custom"}),o(ke,{align:"left",label:"备注","min-width":"150",prop:"description",sortable:"custom"}),o(ke,{align:"left",label:"二级渠道","min-width":"150",prop:"description",sortable:"custom"}),o(ke,{align:"left",label:"一级渠道","min-width":"150",prop:"method",sortable:"custom"},{default:i((e=>[t("div",null,c(e.row.method)+" / "+c(y(e.row.method)),1)])),_:1}),o(ke,{align:"left",fixed:"right",label:"操作",width:"200"},{default:i((e=>[o(S,{icon:"edit",type:"primary",link:"",onClick:a=>(async e=>{const a=await I({id:e.ID});O.value=a.data.api,_e("edit")})(e.row)},{default:i((()=>[p("编辑")])),_:2},1032,["onClick"]),o(S,{icon:"delete",type:"primary",link:"",onClick:a=>(async e=>{v.confirm("此操作将永久删除所有角色下该api, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await q(e)).code&&(m({type:"success",message:"删除成功!"}),1===oe.value.length&&ae.value>1&&ae.value--,ne())}))})(e.row)},{default:i((()=>[p("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),t("div",Z,[o(xe,{"current-page":ae.value,"page-size":te.value,"page-sizes":[10,30,50,100],total:le.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:pe,onSizeChange:re},null,8,["current-page","page-size","total"])])]),o(Ae,{modelValue:ye.value,"onUpdate:modelValue":b[16]||(b[16]=e=>ye.value=e),"before-close":we,title:be.value},{footer:i((()=>[t("div",$,[o(S,{onClick:we},{default:i((()=>[p("取 消")])),_:1}),o(S,{type:"primary",onClick:je},{default:i((()=>[p("确 定")])),_:1})])])),default:i((()=>[o(P,{title:"新增API，需要在角色管理内配置权限才可使用"}),o(D,{ref_key:"apiForm",ref:he,model:O.value,rules:ee.value,"label-width":"80px"},{default:i((()=>[o(G,{label:"路径",prop:"path"},{default:i((()=>[o(E,{modelValue:O.value.path,"onUpdate:modelValue":b[12]||(b[12]=e=>O.value.path=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),o(G,{label:"请求",prop:"method"},{default:i((()=>[o(T,{modelValue:O.value.method,"onUpdate:modelValue":b[13]||(b[13]=e=>O.value.method=e),placeholder:"请选择",style:{width:"100%"}},{default:i((()=>[(a(!0),l(s,null,u(H.value,(e=>(a(),r(z,{key:e.value,label:"".concat(e.label,"(").concat(e.value,")"),value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(G,{label:"api分组",prop:"apiGroup"},{default:i((()=>[o(E,{modelValue:O.value.apiGroup,"onUpdate:modelValue":b[14]||(b[14]=e=>O.value.apiGroup=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),o(G,{label:"api简介",prop:"description"},{default:i((()=>[o(E,{modelValue:O.value.description,"onUpdate:modelValue":b[15]||(b[15]=e=>O.value.description=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-a4b27087"]]);export{W as default};
