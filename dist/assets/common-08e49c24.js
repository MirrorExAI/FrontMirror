/*! 
 Build based on gin-vue-admin 
 Time : 1697372399000 */
import{s as e,a as t,m as s,o as a,c as o,d as i,w as n,g as l,G as r,k as d,E as c}from"./index-f8b29c45.js";import{E as p}from"./upload-b036bc64.js";import"./progress-ace5b054.js";/* empty css               */import{_ as u}from"./_plugin-vue_export-helper-1b428a4d.js";const h=t=>e({url:"/fileUploadAndDownload/getFileList",method:"post",data:t}),m=t=>e({url:"/fileUploadAndDownload/deleteFile",method:"post",data:t}),f=t=>e({url:"/fileUploadAndDownload/editFileName",method:"post",data:t});class g{constructor(e,t,s=1920){this.file=e,this.fileSize=t,this.maxWH=s}compress(){const e=this.file.type,t=this.file.size/1024;return new Promise((s=>{const a=new FileReader;a.readAsDataURL(this.file),a.onload=()=>{const o=document.createElement("canvas"),i=document.createElement("img");i.src=a.result,i.onload=()=>{const a=o.getContext("2d"),n=this.dWH(i.width,i.height,this.maxWH);o.width=n.width,o.height=n.height,a.clearRect(0,0,o.width,o.height),a.drawImage(i,0,0,o.width,o.height);const l=o.toDataURL(e,.9),r=this.fileSizeKB(l);r>this.fileSize&&console.log("图片尺寸太大!"+t+" >> "+r);const d=this.dataURLtoBlob(l,e),c=new File([d],this.file.name);s(c)}}}))}dWH(e,t,s){const a={width:e,height:t};return Math.max(e,t)>s?e>t?(a.width=s,a.height=Math.round(t*(s/e)),a):(a.height=s,a.width=Math.round(e*(s/t)),a):a}fileSizeKB(e){let t=0;return t=Math.round(3*e.split(",")[1].length/4/1024),t}dataURLtoBlob(e,t){const s=atob(e.split(",")[1]);let a=e.split(",")[0].split(":")[1].split(";")[0];const o=new ArrayBuffer(s.length),i=new Uint8Array(o);for(let n=0;n<s.length;n++)i[n]=s.charCodeAt(n);return t&&(a=t),new Blob([o],{type:a,lastModifiedDate:new Date})}}const w=e=>e&&"http"!==e.slice(0,4)?"//"+e:e,y={name:"UploadImage",methods:{}},b=u(Object.assign(y,{props:{imageUrl:{type:String,default:""},fileSize:{type:Number,default:2048},maxWH:{type:Number,default:1920}},emits:["on-success"],setup(e,{emit:u}){const h=e,m=t("https://api.bitcoin-wen.com"),f=s(),w=e=>{const t="image/jpeg"===e.type,s="image/png"===e.type;if(!t&&!s)return d.error("上传头像图片只能是 jpg或png 格式!"),!1;const a=e.size/1024<h.fileSize;if(!a){return new g(e,h.fileSize,h.maxWH).compress()}return a},y=e=>{const{data:t}=e;t.file&&u("on-success",t.file.url)};return(e,t)=>{const s=c,d=p;return a(),o("div",null,[i(d,{action:"".concat(m.value,"/fileUploadAndDownload/upload"),headers:{"x-token":r(f).token},"show-file-list":!1,"on-success":y,"before-upload":w,multiple:!1},{default:n((()=>[i(s,{type:"primary"},{default:n((()=>[l("压缩上传")])),_:1})])),_:1},8,["action","headers"])])}}}),[["__scopeId","data-v-c73174ca"]]),U={name:"UploadCommon",methods:{}},j=Object.assign(U,{emits:["on-success"],setup(e,{emit:u}){const h=t("https://api.bitcoin-wen.com"),m=s(),f=t(!1),g=e=>{f.value=!0;const t="image/jpeg"===e.type,s="image/png"===e.type,a=e.size/1024/1024<.5;return t||s||(d.error("上传图片只能是 jpg或png 格式!"),f.value=!1),a||(d.error("未压缩的上传图片大小不能超过 500KB，请使用压缩上传"),f.value=!1),(s||t)&&a},w=e=>{const{data:t}=e;t.file&&u("on-success",t.file.url)},y=()=>{d({type:"error",message:"上传失败"}),f.value=!1};return(e,t)=>{const s=c,d=p;return a(),o("div",null,[i(d,{action:"".concat(h.value,"/fileUploadAndDownload/upload"),"before-upload":g,headers:{"x-token":r(m).token},"on-error":y,"on-success":w,"show-file-list":!1,class:"upload-btn"},{default:n((()=>[i(s,{type:"primary"},{default:n((()=>[l("普通上传")])),_:1})])),_:1},8,["action","headers"])])}}});export{b as U,j as _,w as a,m as d,f as e,h as g};
