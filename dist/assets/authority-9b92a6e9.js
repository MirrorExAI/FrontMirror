/*! 
 Build based on gin-vue-admin 
 Time : 1696555582000 */
import{a,o as e,c as t,d as l,b as o,w as r,g as i,G as u,aK as d,h as s,e as n,a4 as p,k as m,E as h,J as y,l as c}from"./index-33d179e9.js";import{E as v}from"./drawer-2bb1458e.js";import"./overlay-848c174d.js";import{E as f,a as I}from"./tab-pane-5c337a66.js";import{E as b}from"./dialog-372401e2.js";import{a as g,E as j}from"./form-item-8ffdb63e.js";/* empty css              */import{E as w}from"./radio-d5552059.js";/* empty css               */import"./tag-0f8d4dae.js";import"./checkbox-56cf07d1.js";import"./scrollbar-81bf16b6.js";import{E as _,a as k}from"./table-column-6999464b.js";/* empty css                *//* empty css             *//* empty css               */import{g as C,d as N,c as V,u as x,a as E}from"./authority-917b1a40.js";import A from"./menus-328a496c.js";import U from"./apis-2682c22a.js";import B from"./datas-2993dcfa.js";import{_ as S}from"./warningBar-6b10fcc0.js";import{t as q}from"./doc-46160848.js";import"./strings-3a3a1b4e.js";import"./_baseClone-0928223b.js";import"./_Uint8Array-1dc9e84a.js";import"./_initCloneObject-3b45d182.js";import"./rand-099990c4.js";import"./isEqual-48baa013.js";import"./cloneDeep-1ccbdd88.js";import"./index-225ec204.js";import"./index-f712fbc3.js";import"./debounce-b561df10.js";import"./tree-03340d85.js";import"./index-e3defacf.js";import"./authorityBtn-eb1594fd.js";import"./_plugin-vue_export-helper-1b428a4d.js";import"./api-27dec5fa.js";const z={class:"authority"},D={class:"gva-table-box"},T={class:"gva-btn-list"},R={class:"dialog-footer"},F={name:"Authority"},G=Object.assign(F,{setup(F){const G=a([{authorityId:0,authorityName:"根角色"}]),J=a(!1),O=a("add"),P=a({}),$=a("新增角色"),H=a(!1),K=a(!1),L=a({}),Q=a({authorityId:0,authorityName:"",parentId:0}),W=a({authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(a,e,t)=>/^[0-9]*[1-9][0-9]*$/.test(e)?t():t(new Error("请输入正整数")),trigger:"blur",message:"必须为正整数"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择父角色",trigger:"blur"}]}),X=a(1),Y=a(0),M=a(999),Z=a([]),aa=a({}),ea=async()=>{const a=await C({page:X.value,pageSize:M.value,...aa.value});0===a.code&&(Z.value=a.data.list,Y.value=a.data.total,X.value=a.data.page,M.value=a.data.pageSize)};ea();const ta=(a,e)=>{P.value[a]=e},la=a(null),oa=a(null),ra=a(null),ia=(a,e)=>{const t=[la,oa,ra];e&&t[e].value.needConfirm&&(t[e].value.enterAndNext(),t[e].value.needConfirm=!1)},ua=a(null),da=()=>{ua.value&&ua.value.resetFields(),Q.value={authorityId:0,authorityName:"",parentId:0}},sa=()=>{da(),H.value=!1,K.value=!1},na=()=>{ua.value.validate((async a=>{if(a){switch(Q.value.authorityId=Number(Q.value.authorityId),O.value){case"add":0===(await E(Q.value)).code&&(m({type:"success",message:"添加成功!"}),ea(),sa());break;case"edit":0===(await x(Q.value)).code&&(m({type:"success",message:"添加成功!"}),ea(),sa());break;case"copy":{const a={authority:{authorityId:0,authorityName:"",datauthorityId:[],parentId:0},oldAuthorityId:0};a.authority.authorityId=Q.value.authorityId,a.authority.authorityName=Q.value.authorityName,a.authority.parentId=Q.value.parentId,a.authority.dataAuthorityId=L.value.dataAuthorityId,a.oldAuthorityId=L.value.authorityId;0===(await V(a)).code&&(m({type:"success",message:"复制成功！"}),ea())}}da(),H.value=!1}}))},pa=()=>{G.value=[{authorityId:0,authorityName:"根角色"}],ma(Z.value,G.value,!1)},ma=(a,e,t)=>{Q.value.authorityId=String(Q.value.authorityId),a&&a.forEach((a=>{if(a.children&&a.children.length){const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===Q.value.authorityId,children:[]};ma(a.children,l.children,t||a.authorityId===Q.value.authorityId),e.push(l)}else{const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===Q.value.authorityId};e.push(l)}}))},ha=a=>{da(),$.value="新增角色",O.value="add",Q.value.parentId=a,pa(),H.value=!0};return(a,C)=>{const V=h,x=y,E=_,F=k,K=w,Y=g,M=c,aa=j,da=b,ma=f,ya=I,ca=v;return e(),t("div",z,[l(S,{title:"注：右上角头像下拉可切换角色"}),o("div",D,[o("div",T,[l(V,{type:"primary",icon:"plus",onClick:C[0]||(C[0]=a=>ha(0))},{default:r((()=>[i("新增角色")])),_:1}),l(x,{class:"cursor-pointer",onClick:C[1]||(C[1]=a=>u(q)("https://www.bilibili.com/video/BV1kv4y1g7nT?p=8&vd_source=f2640257c21e3b547a790461ed94875e"))},{default:r((()=>[l(u(d))])),_:1})]),l(F,{data:Z.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:r((()=>[l(E,{label:"角色ID","min-width":"180",prop:"authorityId"}),l(E,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),l(E,{align:"left",label:"操作",width:"460"},{default:r((a=>[l(V,{icon:"setting",type:"primary",link:"",onClick:e=>{return t=a.row,J.value=!0,void(P.value=t);var t}},{default:r((()=>[i("设置权限")])),_:2},1032,["onClick"]),l(V,{icon:"plus",type:"primary",link:"",onClick:e=>ha(a.row.authorityId)},{default:r((()=>[i("新增子角色")])),_:2},1032,["onClick"]),l(V,{icon:"copy-document",type:"primary",link:"",onClick:e=>(a=>{pa(),$.value="拷贝角色",O.value="copy";for(const e in Q.value)Q.value[e]=a[e];L.value=a,H.value=!0})(a.row)},{default:r((()=>[i("拷贝")])),_:2},1032,["onClick"]),l(V,{icon:"edit",type:"primary",link:"",onClick:e=>(a=>{pa(),$.value="编辑角色",O.value="edit";for(const e in Q.value)Q.value[e]=a[e];pa(),H.value=!0})(a.row)},{default:r((()=>[i("编辑")])),_:2},1032,["onClick"]),l(V,{icon:"delete",type:"primary",link:"",onClick:e=>{return t=a.row,void p.confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await N({authorityId:t.authorityId})).code&&(m({type:"success",message:"删除成功!"}),1===Z.value.length&&X.value>1&&X.value--,ea())})).catch((()=>{m({type:"info",message:"已取消删除"})}));var t}},{default:r((()=>[i("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),l(da,{modelValue:H.value,"onUpdate:modelValue":C[5]||(C[5]=a=>H.value=a),title:$.value},{footer:r((()=>[o("div",R,[l(V,{onClick:sa},{default:r((()=>[i("取 消")])),_:1}),l(V,{type:"primary",onClick:na},{default:r((()=>[i("确 定")])),_:1})])])),default:r((()=>[l(aa,{ref_key:"authorityForm",ref:ua,model:Q.value,rules:W.value,"label-width":"80px"},{default:r((()=>[l(Y,{label:"父级角色",prop:"parentId"},{default:r((()=>[l(K,{modelValue:Q.value.parentId,"onUpdate:modelValue":C[2]||(C[2]=a=>Q.value.parentId=a),style:{width:"100%"},disabled:"add"===O.value,options:G.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),l(Y,{label:"角色ID",prop:"authorityId"},{default:r((()=>[l(M,{modelValue:Q.value.authorityId,"onUpdate:modelValue":C[3]||(C[3]=a=>Q.value.authorityId=a),disabled:"edit"===O.value,autocomplete:"off",maxlength:"15"},null,8,["modelValue","disabled"])])),_:1}),l(Y,{label:"角色姓名",prop:"authorityName"},{default:r((()=>[l(M,{modelValue:Q.value.authorityName,"onUpdate:modelValue":C[4]||(C[4]=a=>Q.value.authorityName=a),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),J.value?(e(),s(ca,{key:0,modelValue:J.value,"onUpdate:modelValue":C[6]||(C[6]=a=>J.value=a),"custom-class":"auth-drawer","with-header":!1,size:"40%",title:"角色配置"},{default:r((()=>[l(ya,{"before-leave":ia,type:"border-card"},{default:r((()=>[l(ma,{label:"角色菜单"},{default:r((()=>[l(A,{ref_key:"menus",ref:la,row:P.value,onChangeRow:ta},null,8,["row"])])),_:1}),l(ma,{label:"角色api"},{default:r((()=>[l(U,{ref_key:"apis",ref:oa,row:P.value,onChangeRow:ta},null,8,["row"])])),_:1}),l(ma,{label:"资源权限"},{default:r((()=>[l(B,{ref_key:"datas",ref:ra,authority:Z.value,row:P.value,onChangeRow:ta},null,8,["authority","row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):n("",!0)])}}});export{G as default};
