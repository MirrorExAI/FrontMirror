/*! 
 Build based on gin-vue-admin 
 Time : 1697152884000 */
import{a,o as e,c as t,d as l,b as o,w as r,g as i,G as u,aM as d,h as s,e as n,a4 as p,k as m,E as h,J as y,l as c}from"./index-37934f2a.js";import{E as v}from"./drawer-5d4a85a4.js";import"./overlay-93d44909.js";import{E as f,a as I}from"./tab-pane-ed706606.js";import{E as b}from"./dialog-71aa2b38.js";import{a as g,E as j}from"./form-item-0ef09b87.js";/* empty css              */import{E as w}from"./radio-204c61f5.js";/* empty css               */import"./tag-eed7c3b2.js";import"./checkbox-1e8f3d72.js";import"./scrollbar-b6c70f3e.js";import{E as _,a as k}from"./table-column-b85be477.js";/* empty css                *//* empty css             *//* empty css               */import{g as C,d as N,c as V,u as x,a as E}from"./authority-4c33df93.js";import A from"./menus-baabcc60.js";import U from"./apis-b3a8630c.js";import B from"./datas-5ccd0612.js";import{_ as D}from"./warningBar-582ed635.js";import{t as q}from"./doc-46160848.js";import"./strings-45cdd6ae.js";import"./_baseClone-29c9b6f9.js";import"./_Uint8Array-ba0cbfca.js";import"./_initCloneObject-8bdd6672.js";import"./rand-099990c4.js";import"./isEqual-fd9c8814.js";import"./cloneDeep-fe074834.js";import"./index-fb5f2d1c.js";import"./index-f16bfdb4.js";import"./debounce-10f46826.js";import"./tree-d8298382.js";import"./index-a86e0dfd.js";import"./authorityBtn-209dad76.js";import"./_plugin-vue_export-helper-1b428a4d.js";import"./api-50f6ce11.js";const R={class:"authority"},S={class:"gva-table-box"},z={class:"gva-btn-list"},O={class:"dialog-footer"},T={name:"Authority"},F=Object.assign(T,{setup(T){const F=a([{authorityId:0,authorityName:"根角色"}]),J=a(!1),M=a("add"),P=a({}),$=a("新增角色"),G=a(!1),H=a(!1),L=a({}),X=a({authorityId:0,authorityName:"",parentId:0}),Y=a({authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(a,e,t)=>/^[0-9]*[1-9][0-9]*$/.test(e)?t():t(new Error("请输入正整数")),trigger:"blur",message:"必须为正整数"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择父角色",trigger:"blur"}]}),Z=a(1),K=a(0),Q=a(999),W=a([]),aa=a({}),ea=async()=>{const a=await C({page:Z.value,pageSize:Q.value,...aa.value});0===a.code&&(W.value=a.data.list,K.value=a.data.total,Z.value=a.data.page,Q.value=a.data.pageSize)};ea();const ta=(a,e)=>{P.value[a]=e},la=a(null),oa=a(null),ra=a(null),ia=(a,e)=>{const t=[la,oa,ra];e&&t[e].value.needConfirm&&(t[e].value.enterAndNext(),t[e].value.needConfirm=!1)},ua=a(null),da=()=>{ua.value&&ua.value.resetFields(),X.value={authorityId:0,authorityName:"",parentId:0}},sa=()=>{da(),G.value=!1,H.value=!1},na=()=>{ua.value.validate((async a=>{if(a){switch(X.value.authorityId=Number(X.value.authorityId),M.value){case"add":0===(await E(X.value)).code&&(m({type:"success",message:"添加成功!"}),ea(),sa());break;case"edit":0===(await x(X.value)).code&&(m({type:"success",message:"添加成功!"}),ea(),sa());break;case"copy":{const a={authority:{authorityId:0,authorityName:"",datauthorityId:[],parentId:0},oldAuthorityId:0};a.authority.authorityId=X.value.authorityId,a.authority.authorityName=X.value.authorityName,a.authority.parentId=X.value.parentId,a.authority.dataAuthorityId=L.value.dataAuthorityId,a.oldAuthorityId=L.value.authorityId;0===(await V(a)).code&&(m({type:"success",message:"复制成功！"}),ea())}}da(),G.value=!1}}))},pa=()=>{F.value=[{authorityId:0,authorityName:"根角色"}],ma(W.value,F.value,!1)},ma=(a,e,t)=>{X.value.authorityId=String(X.value.authorityId),a&&a.forEach((a=>{if(a.children&&a.children.length){const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===X.value.authorityId,children:[]};ma(a.children,l.children,t||a.authorityId===X.value.authorityId),e.push(l)}else{const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===X.value.authorityId};e.push(l)}}))},ha=a=>{da(),$.value="新增角色",M.value="add",X.value.parentId=a,pa(),G.value=!0};return(a,C)=>{const V=h,x=y,E=_,T=k,H=w,K=g,Q=c,aa=j,da=b,ma=f,ya=I,ca=v;return e(),t("div",R,[l(D,{title:"注：右上角头像下拉可切换角色"}),o("div",S,[o("div",z,[l(V,{type:"primary",icon:"plus",onClick:C[0]||(C[0]=a=>ha(0))},{default:r((()=>[i("新增角色")])),_:1}),l(x,{class:"cursor-pointer",onClick:C[1]||(C[1]=a=>u(q)("https://www.bilibili.com/video/BV1kv4y1g7nT?p=8&vd_source=f2640257c21e3b547a790461ed94875e"))},{default:r((()=>[l(u(d))])),_:1})]),l(T,{data:W.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:r((()=>[l(E,{label:"角色ID","min-width":"180",prop:"authorityId"}),l(E,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),l(E,{align:"left",label:"操作",width:"460"},{default:r((a=>[l(V,{icon:"setting",type:"primary",link:"",onClick:e=>{return t=a.row,J.value=!0,void(P.value=t);var t}},{default:r((()=>[i("设置权限")])),_:2},1032,["onClick"]),l(V,{icon:"plus",type:"primary",link:"",onClick:e=>ha(a.row.authorityId)},{default:r((()=>[i("新增子角色")])),_:2},1032,["onClick"]),l(V,{icon:"copy-document",type:"primary",link:"",onClick:e=>(a=>{pa(),$.value="拷贝角色",M.value="copy";for(const e in X.value)X.value[e]=a[e];L.value=a,G.value=!0})(a.row)},{default:r((()=>[i("拷贝")])),_:2},1032,["onClick"]),l(V,{icon:"edit",type:"primary",link:"",onClick:e=>(a=>{pa(),$.value="编辑角色",M.value="edit";for(const e in X.value)X.value[e]=a[e];pa(),G.value=!0})(a.row)},{default:r((()=>[i("编辑")])),_:2},1032,["onClick"]),l(V,{icon:"delete",type:"primary",link:"",onClick:e=>{return t=a.row,void p.confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await N({authorityId:t.authorityId})).code&&(m({type:"success",message:"删除成功!"}),1===W.value.length&&Z.value>1&&Z.value--,ea())})).catch((()=>{m({type:"info",message:"已取消删除"})}));var t}},{default:r((()=>[i("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),l(da,{modelValue:G.value,"onUpdate:modelValue":C[5]||(C[5]=a=>G.value=a),title:$.value},{footer:r((()=>[o("div",O,[l(V,{onClick:sa},{default:r((()=>[i("取 消")])),_:1}),l(V,{type:"primary",onClick:na},{default:r((()=>[i("确 定")])),_:1})])])),default:r((()=>[l(aa,{ref_key:"authorityForm",ref:ua,model:X.value,rules:Y.value,"label-width":"80px"},{default:r((()=>[l(K,{label:"父级角色",prop:"parentId"},{default:r((()=>[l(H,{modelValue:X.value.parentId,"onUpdate:modelValue":C[2]||(C[2]=a=>X.value.parentId=a),style:{width:"100%"},disabled:"add"===M.value,options:F.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),l(K,{label:"角色ID",prop:"authorityId"},{default:r((()=>[l(Q,{modelValue:X.value.authorityId,"onUpdate:modelValue":C[3]||(C[3]=a=>X.value.authorityId=a),disabled:"edit"===M.value,autocomplete:"off",maxlength:"15"},null,8,["modelValue","disabled"])])),_:1}),l(K,{label:"角色姓名",prop:"authorityName"},{default:r((()=>[l(Q,{modelValue:X.value.authorityName,"onUpdate:modelValue":C[4]||(C[4]=a=>X.value.authorityName=a),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),J.value?(e(),s(ca,{key:0,modelValue:J.value,"onUpdate:modelValue":C[6]||(C[6]=a=>J.value=a),"custom-class":"auth-drawer","with-header":!1,size:"40%",title:"角色配置"},{default:r((()=>[l(ya,{"before-leave":ia,type:"border-card"},{default:r((()=>[l(ma,{label:"角色菜单"},{default:r((()=>[l(A,{ref_key:"menus",ref:la,row:P.value,onChangeRow:ta},null,8,["row"])])),_:1}),l(ma,{label:"角色api"},{default:r((()=>[l(U,{ref_key:"apis",ref:oa,row:P.value,onChangeRow:ta},null,8,["row"])])),_:1}),l(ma,{label:"资源权限"},{default:r((()=>[l(B,{ref_key:"datas",ref:ra,authority:W.value,row:P.value,onChangeRow:ta},null,8,["authority","row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):n("",!0)])}}});export{F as default};
