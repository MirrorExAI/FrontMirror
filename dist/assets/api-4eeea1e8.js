/*! 
 Build based on gin-vue-admin 
 Time : 1697360087000 */
import{a as e,o as a,c as l,b as t,d as o,w as i,M as u,N as s,h as r,g as p,G as d,aO as n,t as c,k as m,a4 as v,l as f,E as g,J as b,p as h,i as y}from"./index-c27ea3c3.js";import{E as _}from"./dialog-aac937ac.js";import"./overlay-b248b148.js";import{E as w}from"./pagination-6209bf52.js";/* empty css              */import"./tag-77c00d46.js";import{E as j,a as V}from"./select-b3913bb0.js";import"./scrollbar-a928ab00.js";/* empty css               */import{E as k,a as C}from"./table-column-6cf6e751.js";import"./checkbox-98da5de1.js";/* empty css                */import{E as x}from"./popover-3d205b3a.js";/* empty css             */import{a as A,E as U}from"./form-item-ad3a3557.js";/* empty css               */import{g as E,d as G,f as I,a as P,u as z,c as T,b as S}from"./api-6ce56ac1.js";import{t as q}from"./stringFun-647a78e9.js";import{_ as D}from"./warningBar-3cbd7d2c.js";import{t as B}from"./doc-46160848.js";import{_ as F}from"./_plugin-vue_export-helper-1b428a4d.js";import"./isEqual-1cd4e078.js";import"./_Uint8Array-3822a848.js";import"./index-7c5497a5.js";import"./index-a2fce14d.js";import"./strings-2a05e2ce.js";import"./debounce-8279176b.js";import"./_initCloneObject-0a66aef7.js";import"./dropdown-2e545871.js";import"./_baseClone-4b4d1ff1.js";const O=e=>(h("data-v-935edbdc"),e=e(),y(),e),R={class:"gva-search-box"},J={class:"gva-table-box"},K={class:"gva-btn-list"},L=O((()=>t("p",null,"确定要删除吗？",-1))),M={style:{"text-align":"right","margin-top":"8px"}},N=O((()=>t("p",null,"确定要刷新Casbin缓存吗？",-1))),Q={style:{"text-align":"right","margin-top":"8px"}},X={class:"gva-pagination"},Y={class:"dialog-footer"},Z={name:"Api"},$=F(Object.assign(Z,{setup(h){const y=e=>{const a=Z.value.filter((a=>a.value===e))[0];return a&&"".concat(a.label)},F=e([]),O=e({path:"",apiGroup:"",method:"",description:""}),Z=e([{value:"POST",label:"创建",type:"success"},{value:"GET",label:"查看",type:""},{value:"PUT",label:"更新",type:"warning"},{value:"DELETE",label:"删除",type:"danger"}]),$=e(""),H=e({path:[{required:!0,message:"请输入api路径",trigger:"blur"}],apiGroup:[{required:!0,message:"请输入组名称",trigger:"blur"}],method:[{required:!0,message:"请选择请求方式",trigger:"blur"}],description:[{required:!0,message:"请输入api介绍",trigger:"blur"}]}),W=e(1),ee=e(0),ae=e(10),le=e([]),te=e({}),oe=()=>{te.value={}},ie=()=>{W.value=1,ae.value=10,pe()},ue=e=>{ae.value=e,pe()},se=e=>{W.value=e,pe()},re=({prop:e,order:a})=>{e&&("ID"===e&&(e="id"),te.value.orderKey=q(e),te.value.desc="descending"===a),pe()},pe=async()=>{const e=await E({page:W.value,pageSize:ae.value,...te.value});0===e.code&&(le.value=e.data.list,ee.value=e.data.total,W.value=e.data.page,ae.value=e.data.pageSize)};pe();const de=e=>{F.value=e},ne=e(!1),ce=async()=>{const e=F.value.map((e=>e.ID)),a=await G({ids:e});0===a.code&&(m({type:"success",message:a.msg}),le.value.length===e.length&&W.value>1&&W.value--,ne.value=!1,pe())},me=e(!1),ve=async()=>{const e=await I();0===e.code&&m({type:"success",message:e.msg}),me.value=!1},fe=e(null),ge=e("新增Api"),be=e(!1),he=e=>{switch(e){case"addApi":ge.value="新增Api";break;case"edit":ge.value="编辑Api"}$.value=e,be.value=!0},ye=()=>{fe.value.resetFields(),O.value={path:"",apiGroup:"",method:"",description:""},be.value=!1},_e=async()=>{fe.value.validate((async e=>{if(e)switch($.value){case"addApi":0===(await T(O.value)).code&&m({type:"success",message:"添加成功",showClose:!0}),pe(),ye();break;case"edit":0===(await z(O.value)).code&&m({type:"success",message:"编辑成功",showClose:!0}),pe(),ye();break;default:m({type:"error",message:"未知操作",showClose:!0})}}))};return(e,h)=>{const E=f,G=A,I=j,z=V,T=g,q=U,$=b,we=x,je=k,Ve=C,ke=w,Ce=_;return a(),l("div",null,[t("div",R,[o(q,{ref:"searchForm",inline:!0,model:te.value},{default:i((()=>[o(G,{label:"路径"},{default:i((()=>[o(E,{modelValue:te.value.path,"onUpdate:modelValue":h[0]||(h[0]=e=>te.value.path=e),placeholder:"路径"},null,8,["modelValue"])])),_:1}),o(G,{label:"描述"},{default:i((()=>[o(E,{modelValue:te.value.description,"onUpdate:modelValue":h[1]||(h[1]=e=>te.value.description=e),placeholder:"描述"},null,8,["modelValue"])])),_:1}),o(G,{label:"API组"},{default:i((()=>[o(E,{modelValue:te.value.apiGroup,"onUpdate:modelValue":h[2]||(h[2]=e=>te.value.apiGroup=e),placeholder:"api组"},null,8,["modelValue"])])),_:1}),o(G,{label:"请求"},{default:i((()=>[o(z,{modelValue:te.value.method,"onUpdate:modelValue":h[3]||(h[3]=e=>te.value.method=e),clearable:"",placeholder:"请选择"},{default:i((()=>[(a(!0),l(u,null,s(Z.value,(e=>(a(),r(I,{key:e.value,label:"".concat(e.label,"(").concat(e.value,")"),value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(G,null,{default:i((()=>[o(T,{type:"primary",icon:"search",onClick:ie},{default:i((()=>[p("查询")])),_:1}),o(T,{icon:"refresh",onClick:oe},{default:i((()=>[p("重置")])),_:1})])),_:1})])),_:1},8,["model"])]),t("div",J,[t("div",K,[o(T,{type:"primary",icon:"plus",onClick:h[4]||(h[4]=e=>he("addApi"))},{default:i((()=>[p("新增")])),_:1}),o($,{class:"cursor-pointer",onClick:h[5]||(h[5]=e=>d(B)("https://www.bilibili.com/video/BV1kv4y1g7nT?p=7&vd_source=f2640257c21e3b547a790461ed94875e"))},{default:i((()=>[o(d(n))])),_:1}),o(we,{modelValue:ne.value,"onUpdate:modelValue":h[8]||(h[8]=e=>ne.value=e),placement:"top",width:"160"},{reference:i((()=>[o(T,{icon:"delete",disabled:!F.value.length,onClick:h[7]||(h[7]=e=>ne.value=!0)},{default:i((()=>[p("删除")])),_:1},8,["disabled"])])),default:i((()=>[L,t("div",M,[o(T,{type:"primary",link:"",onClick:h[6]||(h[6]=e=>ne.value=!1)},{default:i((()=>[p("取消")])),_:1}),o(T,{type:"primary",onClick:ce},{default:i((()=>[p("确定")])),_:1})])])),_:1},8,["modelValue"]),o(we,{modelValue:me.value,"onUpdate:modelValue":h[11]||(h[11]=e=>me.value=e),placement:"top",width:"160"},{reference:i((()=>[o(T,{icon:"Refresh",onClick:h[10]||(h[10]=e=>me.value=!0)},{default:i((()=>[p("刷新缓存")])),_:1})])),default:i((()=>[N,t("div",Q,[o(T,{type:"primary",link:"",onClick:h[9]||(h[9]=e=>me.value=!1)},{default:i((()=>[p("取消")])),_:1}),o(T,{type:"primary",onClick:ve},{default:i((()=>[p("确定")])),_:1})])])),_:1},8,["modelValue"])]),o(Ve,{data:le.value,onSortChange:re,onSelectionChange:de},{default:i((()=>[o(je,{type:"selection",width:"55"}),o(je,{align:"left",label:"id","min-width":"60",prop:"ID",sortable:"custom"}),o(je,{align:"left",label:"API路径","min-width":"150",prop:"path",sortable:"custom"}),o(je,{align:"left",label:"API分组","min-width":"150",prop:"apiGroup",sortable:"custom"}),o(je,{align:"left",label:"API简介","min-width":"150",prop:"description",sortable:"custom"}),o(je,{align:"left",label:"请求","min-width":"150",prop:"method",sortable:"custom"},{default:i((e=>[t("div",null,c(e.row.method)+" / "+c(y(e.row.method)),1)])),_:1}),o(je,{align:"left",fixed:"right",label:"操作",width:"200"},{default:i((e=>[o(T,{icon:"edit",type:"primary",link:"",onClick:a=>(async e=>{const a=await P({id:e.ID});O.value=a.data.api,he("edit")})(e.row)},{default:i((()=>[p("编辑")])),_:2},1032,["onClick"]),o(T,{icon:"delete",type:"primary",link:"",onClick:a=>(async e=>{v.confirm("此操作将永久删除所有角色下该api, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await S(e)).code&&(m({type:"success",message:"删除成功!"}),1===le.value.length&&W.value>1&&W.value--,pe())}))})(e.row)},{default:i((()=>[p("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),t("div",X,[o(ke,{"current-page":W.value,"page-size":ae.value,"page-sizes":[10,30,50,100],total:ee.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:se,onSizeChange:ue},null,8,["current-page","page-size","total"])])]),o(Ce,{modelValue:be.value,"onUpdate:modelValue":h[16]||(h[16]=e=>be.value=e),"before-close":ye,title:ge.value},{footer:i((()=>[t("div",Y,[o(T,{onClick:ye},{default:i((()=>[p("取 消")])),_:1}),o(T,{type:"primary",onClick:_e},{default:i((()=>[p("确 定")])),_:1})])])),default:i((()=>[o(D,{title:"新增API，需要在角色管理内配置权限才可使用"}),o(q,{ref_key:"apiForm",ref:fe,model:O.value,rules:H.value,"label-width":"80px"},{default:i((()=>[o(G,{label:"路径",prop:"path"},{default:i((()=>[o(E,{modelValue:O.value.path,"onUpdate:modelValue":h[12]||(h[12]=e=>O.value.path=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),o(G,{label:"请求",prop:"method"},{default:i((()=>[o(z,{modelValue:O.value.method,"onUpdate:modelValue":h[13]||(h[13]=e=>O.value.method=e),placeholder:"请选择",style:{width:"100%"}},{default:i((()=>[(a(!0),l(u,null,s(Z.value,(e=>(a(),r(I,{key:e.value,label:"".concat(e.label,"(").concat(e.value,")"),value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),o(G,{label:"api分组",prop:"apiGroup"},{default:i((()=>[o(E,{modelValue:O.value.apiGroup,"onUpdate:modelValue":h[14]||(h[14]=e=>O.value.apiGroup=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),o(G,{label:"api简介",prop:"description"},{default:i((()=>[o(E,{modelValue:O.value.description,"onUpdate:modelValue":h[15]||(h[15]=e=>O.value.description=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}}),[["__scopeId","data-v-935edbdc"]]);export{$ as default};
