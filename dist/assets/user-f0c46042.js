/*! 
 Build based on gin-vue-admin 
 Time : 1696555582000 */
import{a as e,X as a,o as l,c as t,d as i,b as o,w as r,g as s,t as u,G as d,h as n,e as p,aO as m,a4 as c,d5 as g,k as v,d6 as h,aP as y,aQ as f,E as b,l as w}from"./index-33d179e9.js";import{E as j}from"./dialog-372401e2.js";import"./overlay-848c174d.js";import{a as _,E as k}from"./form-item-8ffdb63e.js";import{E as I}from"./switch-10d77d4a.js";import{E as x}from"./radio-d5552059.js";/* empty css              *//* empty css               */import"./tag-0f8d4dae.js";import"./checkbox-56cf07d1.js";import"./scrollbar-81bf16b6.js";import{E as V}from"./pagination-a4874b9b.js";import"./select-a26e10b7.js";import{E as C,a as N}from"./table-column-6999464b.js";/* empty css                */import{E as z}from"./popover-626e072a.js";/* empty css               */import{g as U}from"./authority-917b1a40.js";import{C as E}from"./index-d1e5f68c.js";import{_ as S}from"./index-8679e9b7.js";import{_ as D}from"./warningBar-6b10fcc0.js";import{f as O}from"./format-6abb9e2f.js";import"./_baseClone-0928223b.js";import"./_Uint8Array-1dc9e84a.js";import"./_initCloneObject-3b45d182.js";import"./rand-099990c4.js";import"./strings-3a3a1b4e.js";import"./isEqual-48baa013.js";import"./cloneDeep-1ccbdd88.js";import"./index-225ec204.js";import"./index-f712fbc3.js";import"./debounce-b561df10.js";import"./dropdown-e62c15be.js";import"./image-viewer-e9617930.js";/* empty css                                                              */import"./_plugin-vue_export-helper-1b428a4d.js";import"./drawer-2bb1458e.js";/* empty css             */import"./common-05cccbcb.js";import"./upload-d74bc7c9.js";import"./progress-910ab077.js";import"./date-225eaf4f.js";import"./dictionary-f99dcf05.js";import"./sysDictionary-62483381.js";const q={class:"gva-table-box"},A={class:"gva-btn-list"},B=o("br",null,null,-1),P=o("p",null,"确定要删除此用户吗",-1),$={style:{"text-align":"right","margin-top":"8px"}},F={class:"gva-pagination"},G={style:{height:"60vh",overflow:"auto",padding:"0 12px"}},J=["src"],Q={key:1,class:"header-img-box"},T={class:"dialog-footer"},X={name:"User"},Z=Object.assign(X,{setup(X){const Z=e("https://api.bitcoin-wen.com/"),R=(e,a)=>{e&&e.forEach((e=>{if(e.children&&e.children.length){const l={authorityId:e.authorityId,authorityName:e.authorityName,children:[]};R(e.children,l.children),a.push(l)}else{const l={authorityId:e.authorityId,authorityName:e.authorityName};a.push(l)}}))},W=e(1),Y=e(0),H=e(10),K=e([]),L=e([{value:0,text:""},{value:1,text:"正常"},{value:2,text:"冻结"}]),M=e=>{H.value=e,ae()},ee=e=>{W.value=e,ae()},ae=async()=>{const e=await m({page:W.value,pageSize:H.value});0===e.code&&(K.value=e.data.list,Y.value=e.data.total,W.value=e.data.page,H.value=e.data.pageSize)};a((()=>K.value),(()=>{le()}));(async()=>{ae();const e=await U({page:1,pageSize:999});re(e.data.list)})();const le=()=>{K.value&&K.value.forEach((e=>{e.authorityIds=e.authorities&&e.authorities.map((e=>e.authorityId))}))},te=e(null),ie=()=>{te.value.open()},oe=e([]),re=e=>{oe.value=[],R(e,oe.value)},se=e({username:"",password:"",nickName:"",headerImg:"",authorityId:"",authorityIds:[],enable:1}),ue=e({userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,message:"最低5位字符",trigger:"blur"}],password:[{required:!0,message:"请输入用户密码",trigger:"blur"},{min:6,message:"最低6位字符",trigger:"blur"}],nickName:[{required:!0,message:"请输入用户昵称",trigger:"blur"}],phone:[{pattern:/^1([38][0-9]|4[014-9]|[59][0-35-9]|6[2567]|7[0-8])\d{8}$/,message:"请输入合法手机号",trigger:"blur"}],email:[{pattern:/^([0-9A-Za-z\-_.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g,message:"请输入正确的邮箱",trigger:"blur"}],authorityId:[{required:!0,message:"请选择用户角色",trigger:"blur"}]}),de=e(null),ne=async()=>{se.value.authorityId=se.value.authorityIds[0],de.value.validate((async e=>{if(e){const e={...se.value};if("add"===ce.value){const a=await y(e);0===a.code&&(v({type:"success",message:"请复制Google验证码：   "+a.data.user.googleSecret}),await ae(),me())}if("edit"===ce.value){0===(await f(e)).code&&(v({type:"success",message:"编辑成功"}),await ae(),me())}}}))},pe=e(!1),me=()=>{de.value.resetFields(),se.value.headerImg="",se.value.authorityIds=[],pe.value=!1},ce=e("add"),ge=()=>{ce.value="add",pe.value=!0};return(e,a)=>{const m=b,y=C,f=z,U=N,X=V,R=w,le=_,re=x,ve=I,he=k,ye=j;return l(),t("div",null,[i(D,{title:"注：右上角头像下拉可切换角色"}),o("div",q,[o("div",A,[i(m,{type:"primary",icon:"plus",onClick:ge},{default:r((()=>[s("新增渠道")])),_:1})]),i(U,{data:K.value,"row-key":"ID"},{default:r((()=>[i(y,{align:"left",label:"头像","min-width":"75"},{default:r((e=>[i(E,{style:{"margin-top":"8px"},"pic-src":e.row.headerImg},null,8,["pic-src"])])),_:1}),i(y,{align:"left",label:"ID","min-width":"50",prop:"ID"}),i(y,{align:"left",label:"用户名","min-width":"150",prop:"userName"}),i(y,{align:"left",label:"上级id","min-width":"150",prop:"parentId"}),i(y,{align:"left",label:"昵称","min-width":"150",prop:"nickName"}),i(y,{align:"left",label:"状态","min-width":"150"},{default:r((e=>[s(u(L.value[e.row.enable].text),1)])),_:1}),i(y,{align:"left",label:"谷歌验证码","min-width":"180",prop:"googleSecret"}),i(y,{align:"left",label:"飞机通知id","min-width":"180",prop:"tg"}),i(y,{align:"left",label:"统计","min-width":"180",prop:"amount"}),i(y,{align:"left",label:"创建时间","min-width":"180"},{default:r((e=>[s(u(d(O)(e.row.CreatedAt))+" ",1),B,s(" "+u(d(O)(e.row.UpdatedAt)),1)])),_:1}),i(y,{label:"操作","min-width":"250",fixed:"right"},{default:r((e=>[i(f,{modelValue:e.row.visible,"onUpdate:modelValue":a=>e.row.visible=a,placement:"top",width:"160"},{reference:r((()=>[i(m,{type:"primary",link:"",icon:"delete"},{default:r((()=>[s("删除")])),_:1})])),default:r((()=>[P,o("div",$,[i(m,{type:"primary",link:"",onClick:a=>e.row.visible=!1},{default:r((()=>[s("取消")])),_:2},1032,["onClick"]),i(m,{type:"primary",onClick:a=>(async e=>{0===(await h({id:e.ID})).code&&(v.success("删除成功"),e.visible=!1,await ae())})(e.row)},{default:r((()=>[s("确定")])),_:2},1032,["onClick"])])])),_:2},1032,["modelValue","onUpdate:modelValue"]),i(m,{type:"primary",link:"",icon:"edit",onClick:a=>{return l=e.row,ce.value="edit",se.value=JSON.parse(JSON.stringify(l)),void(pe.value=!0);var l}},{default:r((()=>[s("编辑")])),_:2},1032,["onClick"]),i(m,{type:"primary",link:"",icon:"magic-stick",onClick:a=>{return l=e.row,void c.confirm("是否将此用户密码重置为123456?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await g({ID:l.ID});0===e.code?v({type:"success",message:e.msg}):v({type:"error",message:e.msg})}));var l}},{default:r((()=>[s("重置密码")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),o("div",F,[i(X,{"current-page":W.value,"page-size":H.value,"page-sizes":[10,30,50,100],total:Y.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:ee,onSizeChange:M},null,8,["current-page","page-size","total"])])]),i(ye,{modelValue:pe.value,"onUpdate:modelValue":a[7]||(a[7]=e=>pe.value=e),title:"用户","show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1},{footer:r((()=>[o("div",T,[i(m,{onClick:me},{default:r((()=>[s("取 消")])),_:1}),i(m,{type:"primary",onClick:ne},{default:r((()=>[s("确 定")])),_:1})])])),default:r((()=>[o("div",G,[i(he,{ref_key:"userForm",ref:de,rules:ue.value,model:se.value,"label-width":"80px"},{default:r((()=>["add"===ce.value?(l(),n(le,{key:0,label:"用户名",prop:"userName"},{default:r((()=>[i(R,{modelValue:se.value.userName,"onUpdate:modelValue":a[0]||(a[0]=e=>se.value.userName=e)},null,8,["modelValue"])])),_:1})):p("",!0),"add"===ce.value?(l(),n(le,{key:1,label:"密码",prop:"password"},{default:r((()=>[i(R,{modelValue:se.value.password,"onUpdate:modelValue":a[1]||(a[1]=e=>se.value.password=e)},null,8,["modelValue"])])),_:1})):p("",!0),i(le,{label:"昵称",prop:"nickName"},{default:r((()=>[i(R,{modelValue:se.value.nickName,"onUpdate:modelValue":a[2]||(a[2]=e=>se.value.nickName=e)},null,8,["modelValue"])])),_:1}),i(le,{label:"手机号",prop:"phone"},{default:r((()=>[i(R,{modelValue:se.value.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>se.value.phone=e)},null,8,["modelValue"])])),_:1}),i(le,{label:"邮箱",prop:"email"},{default:r((()=>[i(R,{modelValue:se.value.email,"onUpdate:modelValue":a[4]||(a[4]=e=>se.value.email=e)},null,8,["modelValue"])])),_:1}),i(le,{label:"用户角色",prop:"authorityId"},{default:r((()=>[i(re,{modelValue:se.value.authorityIds,"onUpdate:modelValue":a[5]||(a[5]=e=>se.value.authorityIds=e),style:{width:"100%"},options:oe.value,"show-all-levels":!1,props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1},null,8,["modelValue","options"])])),_:1}),i(le,{label:"启用",prop:"disabled"},{default:r((()=>[i(ve,{modelValue:se.value.enable,"onUpdate:modelValue":a[6]||(a[6]=e=>se.value.enable=e),"inline-prompt":"","active-value":1,"inactive-value":2},null,8,["modelValue"])])),_:1}),i(le,{label:"头像","label-width":"80px"},{default:r((()=>[o("div",{style:{display:"inline-block"},onClick:ie},[se.value.headerImg?(l(),t("img",{key:0,alt:"头像",class:"header-img-box",src:se.value.headerImg&&"http"!==se.value.headerImg.slice(0,4)?Z.value+se.value.headerImg:se.value.headerImg},null,8,J)):(l(),t("div",Q,"从媒体库选择"))])])),_:1})])),_:1},8,["rules","model"])])])),_:1},8,["modelValue"]),i(S,{ref_key:"chooseImg",ref:te,target:se.value,"target-key":"headerImg"},null,8,["target"])])}}});export{Z as default};
